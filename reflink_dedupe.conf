# /usr/local/etc/reflink_dedupe.conf
# reflink_dedupe - A FreeBSD utility for deduplication using reflinks.
#
# Copyright (c) 2025, Sophia Hadash
# All rights reserved.
#
# Licensed under the BSD 2-Clause License. See LICENSE file for details.
#
# Default configuration for reflink_dedupe
# Lines beginning with '#' are comments.

##################################################
# General Settings
##################################################

# Root working path for deduplication / indexing
DEDUPLICATION_ROOT="/"

# SQLite3 database location
DB="/var/db/reflink_dedupe.db"

# PID file location
PID_FILE="/var/run/reflink_dedupe.pid"

# Command used for hashing files
# (must output only the hash string on stdout)
HASH_CMD="sha256 -q"

# Command used for reflinking files
# Expects to take two file paths after the listed command
# E.g. when REFLINK_CMD="cp" utility will execute cp file1 file2
# Command must make a reflinked copy of file1 at file2
REFLINK_CMD="cp"

# The maximum amount of threads to use.
# The number of threads listed here will be shared between the deduplication and the watcher.
# Leave empty to use the number of threads available to the system.
THREADS=""

# Temporary working directory
TMP_DIR="/tmp/reflink_dedupe"

# Directory for lock files
LOCK_DIR="/var/lock/reflink_dedupe"

# The clean task deletes files from the database that no longer exist in batches. This variable
# specifies the batch size.
CLEAN_BATCH_SIZE="100"

# The find-duplicates task finds duplicates within the indexed files in batches. This variable
# specifies the batch size.
FIND_DUPLICATES_BATCH_SIZE="1000"

##################################################
# Scheduling settings
##################################################

# Maximum database entries to check for cleanup per schedule run. Zero indicates no maximum.
SCHEDULE_CLEAN_MAX_COUNT="0"

# Maximum duration in seconds of cleaning per schedule run. Cleaning will be stopped when this
# duration is reached. Zero indicates no maximum.
SCHEDULE_CLEAN_MAX_DURATION="0"

# Flag to skip cleaning entirely. When set to 1 cleaning will we skipped during scheduled executions.
SCHEDULE_CLEAN_SKIP="0"

# Maximum hashes to compute per schedule run. Zero indicates no maximum.
SCHEDULE_INDEXING_MAX_COUNT="0"

# Maximum duration in seconds of indexing per schedule run. Indexing will be stopped when this
# duration is reached. Zero indicates no maximum.
SCHEDULE_INDEXING_MAX_DURATION="0"

# Flag to skip indexing entirely. When set to 1 indexing will we skipped during scheduled executions.
SCHEDULE_INDEXING_SKIP="0"

# Maximum find-duplicate batches to execute per schedule run. Zero indicates no maximum.
SCHEDULE_FIND_DUPLICATES_MAX_COUNT="0"

# Maximum duration in seconds of finding duplicates per schedule run. Finding duplicates will be stopped when this
# duration is reached. Zero indicates no maximum.
SCHEDULE_FIND_DUPLICATES_MAX_DURATION="0"

# Flag to skip finding duplicates entirely. When set to 1 finding duplicates will we skipped during scheduled executions.
SCHEDULE_FIND_DUPLICATES_SKIP="0"

# Maximum reflinks to create per schedule run. Zero indicates no maximum.
SCHEDULE_REFLINKING_MAX_COUNT="0"

# Maximum duration in seconds of creating reflinks per schedule run. Creating reflinks will be stopped when this
# duration is reached. Zero indicates no maximum.
SCHEDULE_REFLINKING_MAX_DURATION="0"

# Flag to skip creating reflinks entirely. When set to 1 creating reflinks will we skipped during scheduled executions.
SCHEDULE_REFLINKING_SKIP="0"

##################################################
# Logging
##################################################

# Interactive dashboard stored to file. Leave empty to disable writing the dashboard to file.
DASHBOARD_FILE="/var/log/reflink_dedupe/dashboard.log"

# Execution report file.
REPORTS_FILE="/var/log/reflink_dedupe/reports.log"

# Verbose logfile with detailed information
LOG_FILE="/var/log/reflink_dedupe/info.log"

# Logfile with only top-level important logs
LOG_FILE_IMPORTANT="/var/log/reflink_dedupe/important.log"

# Logfile with errors
LOG_FILE_ERRORS="/var/log/reflink_dedupe/errors.log"

# Logfile with only actual or simulated actions
# (depending on DRY_RUN)
LOG_FILE_ACTIONS="/var/log/reflink_dedupe/actions.log"

##################################################
# Operation Modes
##################################################

# Dry-run mode (1 = donâ€™t modify files, only log actions)
DRY_RUN="0"

# Enable zfs zpool monitoring of block cloning statistics
STATISTICS_ZPOOL_MONITOR_ENABLED="0"

# The zfs pool to monitor
STATISTICS_ZPOOL_MONITOR_ZPOOL="rpool"

##################################################
# Watcher Settings
##################################################

# Paths for which to subscribe to events and create reflinks on-the-fly.
# Must contain (a list of) relative paths to the DEDUPLICATION_ROOT.
# WATCH_PATHS supports multiple paths, separated by semicolons (;).
# Paths can contain spaces. Example:
# WATCH_PATHS="example/watch_dir;example/watch_dir2"
WATCH_PATHS=""

# The debounce time for the watcher.
# Specifies how many seconds to wait before processing observed events on a file.
# The timer resets when new events occur.
WATCHER_DEBOUNCE_SECONDS="60"

# The amount of threads to use for fs watching.
WATCH_THREADS="1"
